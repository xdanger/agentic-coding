# 系统架构

## 1. 项目愿景与目标

本项目旨在建立一个面向 Agentic Coding 的软件工程框架，以优化 AI/Agent 在软件开发过程中的能力和效率。该框架通过提供结构化的环境来弥补 LLMs 在全局理解、意图理解、历史记忆和未来规划方面的局限性。

## 2. 核心原则

### 2.1 设计原则

1. **分离关注点**：明确区分人类和 AI 的责任和职权范围
2. **全局背景共享**：确保所有参与者（人类和 AI）都能访问相同的项目上下文
3. **文档优先**：所有决策和设计必须先记录在案再实施
4. **知识积累**：通过系统化的方式记录和利用历史经验
5. **反馈循环**：建立从开发到测试、部署和监控的完整反馈环
6. **标准遵循**：建立并严格执行编码和文档标准

### 2.2 业务规则

1. AI 必须按照 `CLAUDE.md` 文件中的指导进行工作
2. 所有代码更改必须有相应的文档更新
3. 所有新功能必须有对应的测试
4. 技术债务必须被明确记录并定期处理
5. 决策必须有明确的理由和背景说明
6. 经验必须被记录和分类以供未来参考

## 3. 系统组件

系统由三个主要部分组成：

### 3.1 文档系统

`/docs` 目录包含所有由人类和 AI 共同维护的项目文档：

- **决策记录**：存储所有重要的架构和设计决策
- **技术债务**：跟踪需要在未来解决的问题或优化机会
- **度量指标**：监控项目健康状况的各种指标
- **技术规范**：包含架构、编码标准、接口定义等规范文档
- **指南**：为开发人员和用户提供的使用和开发指南

### 3.2 AI代理系统

`/.agent` 目录存储所有 AI 维护的记忆和智能工作产物：

- **任务记录**：记录每次任务执行的详细信息，包括考虑的方法、决策和实施结果
- **经验库**：汇总并分类 AI 在工作中积累的经验教训
- **版本发布**：记录发布的版本信息
- **规则库**：存储针对特定 AI 工具的规则和配置

### 3.3 源代码系统

`/src` 和 `/tests` 目录包含项目的源代码和测试代码。

## 4. 目录结构与职责

### 4.1 整体目录结构

```
project-root/
├── .agent/                            # AI/Agent特定资源（由AI维护）
│   ├── tasks/                         # 任务执行历史
│   ├── reflections/                   # 经验教训和反思
│   ├── releases/                      # 版本发布信息
│   └── rules/                         # AI工具特定规则
├── docs/                              # 项目文档（由人类维护）
│   ├── debts/                         # 技术债务跟踪
│   ├── decisions/                     # 决策记录（仅限人类）
│   ├── metrics/                       # 项目健康指标
│   ├── specs/                         # 技术规范
│   └── guides/                        # 开发和使用指南
├── src/                               # 源代码
├── tests/                             # 测试代码
├── CHANGELOG.md                       # 项目历史和变更日志
├── CLAUDE.md                          # Claude Code的指令
└── README.md                          # 项目概述
```

### 4.2 `.agent/` 目录详情

`.agent/` 目录由AI代理维护，包含帮助AI代理有效工作的记录、反思和规则。

| 子目录 | 文件格式 | 目的 | 管理要求 |
|--------|----------|------|----------|
| **tasks/** | `YYYY-MM/DD_{TIMESTAMP}.md` | 保存上下文、决策和实施细节供将来参考 | 更新现有相似任务记录，而非创建重复项 |
| **reflections/** | `YYYY-MM/{TITLE}.md` | 整合关于模式、陷阱和最佳实践的知识 | 整合类似反思，而非创建重复项 |
| **releases/** | `YYYY-MM/v{VERSION_NUMBER}.md` | 记录每个版本包含的功能、修复和变更 | 按版本号组织 |
| **rules/** | 无特定格式 | 为Cursor Editor等AI工具提供指导 | 按工具类型组织 |

### 4.3 `docs/` 目录详情

`docs/` 目录主要由人类维护。AI代理可以建议更改，但未经明确指示不得修改这些文件。

| 子目录 | 文件格式 | 目的 | 限制 |
|--------|----------|------|------|
| **debts/** | `{DEBT_TITLE}.md` | 记录已知问题、其影响和潜在解决方案 | 需要人类批准 |
| **decisions/** | `YYYY/{SEQUENCE_NUMBER}_{TITLE}.md` | 记录重要的架构和设计决策及其背景和理由 | AI代理在任何情况下都不得修改 |
| **metrics/** | 多个固定文件 | 跟踪性能、代码质量和测试覆盖率 | AI代理只能建议更改 |
| **specs/** | 多个固定文件 | 定义架构、编码标准、接口和其他技术指南 | AI代理只能建议更改 |
| **guides/** | 无特定格式 | 为开发人员和用户提供指导 | AI代理只能建议更改 |

### 4.4 根目录文件

| 文件 | 目的 | 更新规则 |
|------|------|----------|
| **CHANGELOG.md** | 提供值得注意的变更的时间记录 | 只记录重大变更 |
| **src/** | 存放所有应用代码 | 遵循编码标准 |
| **tests/** | 存放应用的所有测试 | 确保测试覆盖率 |
| **CLAUDE.md** | 为Claude AI系统提供指导 | 随系统演进更新 |
| **README.md** | 向新用户和开发人员介绍项目 | 保持简洁和最新 |

## 5. 管理规范

### 5.1 AI修改权限

- AI代理可以自由创建和更新`.agent/`目录内的文件
- AI代理在未经明确人类指示的情况下，绝不能创建或修改`docs/`目录中的文件
- AI代理在任何情况下都不得创建或修改`docs/decisions/`中的文件
- AI代理可以建议对`docs/`目录中的文件进行更改，但必须等待人类批准

### 5.2 文件命名约定

- 遵循为每个目录指定的文件名格式
- 一般文件命名使用小写字母和连字符
- 对于时间序列文件使用适当的基于日期的前缀

### 5.3 内容组织

- 将相关信息分组在一起
- 在文件内部和文件之间使用一致的格式
- 在相关文件之间保持适当的交叉引用
